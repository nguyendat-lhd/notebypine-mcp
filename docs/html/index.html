<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoteByPine MCP - Incident Management Dashboard</title>
    <style>
        :root {
  /* Primitive Color Tokens */
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-teal-800: rgba(41, 150, 161, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);

  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;
  --color-red-500-rgb: 192, 21, 47;
  --color-red-400-rgb: 255, 84, 89;
  --color-orange-500-rgb: 168, 75, 47;
  --color-orange-400-rgb: 230, 129, 97;

  --color-bg-1: rgba(59, 130, 246, 0.08);
  --color-bg-2: rgba(245, 158, 11, 0.08);
  --color-bg-3: rgba(34, 197, 94, 0.08);
  --color-bg-4: rgba(239, 68, 68, 0.08);
  --color-bg-5: rgba(147, 51, 234, 0.08);
  --color-bg-6: rgba(249, 115, 22, 0.08);
  --color-bg-7: rgba(236, 72, 153, 0.08);
  --color-bg-8: rgba(6, 182, 212, 0.08);

  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
  --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

  --focus-ring: 0 0 0 3px var(--color-focus-ring);
  --focus-outline: 2px solid var(--color-primary);
  --status-bg-opacity: 0.15;
  --status-border-opacity: 0.25;

  --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  --font-size-xs: 11px;
  --font-size-sm: 12px;
  --font-size-base: 14px;
  --font-size-md: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-2xl: 20px;
  --font-size-3xl: 24px;
  --font-size-4xl: 30px;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 550;
  --font-weight-bold: 600;
  --line-height-tight: 1.2;
  --line-height-normal: 1.5;
  --letter-spacing-tight: -0.01em;

  --space-0: 0;
  --space-1: 1px;
  --space-2: 2px;
  --space-4: 4px;
  --space-6: 6px;
  --space-8: 8px;
  --space-10: 10px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;
  --space-32: 32px;

  --radius-sm: 6px;
  --radius-base: 8px;
  --radius-md: 10px;
  --radius-lg: 12px;
  --radius-full: 9999px;

  --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04), 0 4px 6px -2px rgba(0, 0, 0, 0.02);
  --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15), inset 0 -1px 0 rgba(0, 0, 0, 0.03);

  --duration-fast: 150ms;
  --duration-normal: 250ms;
  --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
}

@media (prefers-color-scheme: dark) {
  :root {
    --color-gray-400-rgb: 119, 124, 124;
    --color-teal-300-rgb: 50, 184, 198;
    --color-gray-300-rgb: 167, 169, 169;
    --color-gray-200-rgb: 245, 245, 245;

    --color-bg-1: rgba(29, 78, 216, 0.15);
    --color-bg-2: rgba(180, 83, 9, 0.15);
    --color-bg-3: rgba(21, 128, 61, 0.15);
    --color-bg-4: rgba(185, 28, 28, 0.15);
    --color-bg-5: rgba(107, 33, 168, 0.15);
    --color-bg-6: rgba(194, 65, 12, 0.15);
    --color-bg-7: rgba(190, 24, 93, 0.15);
    --color-bg-8: rgba(8, 145, 178, 0.15);

    --color-background: var(--color-charcoal-700);
    --color-surface: var(--color-charcoal-800);
    --color-text: var(--color-gray-200);
    --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
    --color-primary: var(--color-teal-300);
    --color-primary-hover: var(--color-teal-400);
    --color-primary-active: var(--color-teal-800);
    --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
    --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
    --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
    --color-border: rgba(var(--color-gray-400-rgb), 0.3);
    --color-error: var(--color-red-400);
    --color-success: var(--color-teal-300);
    --color-warning: var(--color-orange-400);
    --color-info: var(--color-gray-300);
    --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
    --color-btn-primary-text: var(--color-slate-900);
    --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
    --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
    --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1), inset 0 -1px 0 rgba(0, 0, 0, 0.15);
    --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);
  }
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html, body {
  height: 100%;
  font-family: var(--font-family-base);
  font-size: var(--font-size-base);
  line-height: var(--line-height-normal);
  color: var(--color-text);
  background-color: var(--color-background);
  -webkit-font-smoothing: antialiased;
}

.app-container {
  display: flex;
  height: 100vh;
  overflow: hidden;
}

/* Sidebar */
.sidebar {
  width: 260px;
  background-color: var(--color-surface);
  border-right: 1px solid var(--color-border);
  display: flex;
  flex-direction: column;
  transition: transform var(--duration-normal) var(--ease-standard);
}

.sidebar-header {
  padding: var(--space-20) var(--space-16);
  border-bottom: 1px solid var(--color-border);
}

.logo {
  display: flex;
  align-items: center;
  gap: var(--space-12);
}

.logo-icon {
  width: 32px;
  height: 32px;
  background: var(--color-primary);
  border-radius: var(--radius-base);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--color-btn-primary-text);
  font-weight: var(--font-weight-bold);
  font-size: var(--font-size-lg);
}

.logo-text {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
}

.nav-menu {
  flex: 1;
  padding: var(--space-16);
  overflow-y: auto;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: var(--space-12);
  padding: var(--space-10) var(--space-12);
  margin-bottom: var(--space-4);
  border-radius: var(--radius-base);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-standard);
  color: var(--color-text-secondary);
  font-weight: var(--font-weight-medium);
}

.nav-item:hover {
  background-color: var(--color-secondary);
  color: var(--color-text);
}

.nav-item.active {
  background-color: var(--color-primary);
  color: var(--color-btn-primary-text);
}

.nav-icon {
  width: 20px;
  height: 20px;
}

/* Main Content */
.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.top-bar {
  background-color: var(--color-surface);
  border-bottom: 1px solid var(--color-border);
  padding: var(--space-16) var(--space-24);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.top-bar-left {
  display: flex;
  align-items: center;
  gap: var(--space-16);
}

.menu-toggle {
  display: none;
  background: none;
  border: none;
  cursor: pointer;
  color: var(--color-text);
  padding: var(--space-8);
}

.page-title {
  font-size: var(--font-size-2xl);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
}

.top-bar-right {
  display: flex;
  align-items: center;
  gap: var(--space-16);
}

.user-profile {
  display: flex;
  align-items: center;
  gap: var(--space-8);
  cursor: pointer;
  padding: var(--space-6) var(--space-12);
  border-radius: var(--radius-base);
  transition: background-color var(--duration-fast) var(--ease-standard);
}

.user-profile:hover {
  background-color: var(--color-secondary);
}

.user-avatar {
  width: 32px;
  height: 32px;
  border-radius: var(--radius-full);
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: var(--font-weight-semibold);
}

.content-area {
  flex: 1;
  overflow-y: auto;
  padding: var(--space-24);
}

/* Cards */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: var(--space-16);
  margin-bottom: var(--space-24);
}

.stat-card {
  background-color: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  padding: var(--space-20);
  transition: all var(--duration-normal) var(--ease-standard);
}

.stat-card:hover {
  box-shadow: var(--shadow-md);
}

.stat-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: var(--space-12);
}

.stat-label {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  font-weight: var(--font-weight-medium);
}

.stat-icon {
  width: 40px;
  height: 40px;
  border-radius: var(--radius-base);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--font-size-xl);
}

.stat-value {
  font-size: var(--font-size-4xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-text);
  margin-bottom: var(--space-4);
}

.stat-change {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

/* Table */
.table-container {
  background-color: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  overflow: hidden;
}

.table-header {
  padding: var(--space-20);
  border-bottom: 1px solid var(--color-border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: var(--space-16);
}

.table-title {
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
}

.table-actions {
  display: flex;
  gap: var(--space-8);
  flex-wrap: wrap;
}

.search-box {
  display: flex;
  align-items: center;
  background-color: var(--color-background);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  padding: var(--space-8) var(--space-12);
  min-width: 250px;
}

.search-box input {
  border: none;
  background: none;
  outline: none;
  flex: 1;
  color: var(--color-text);
  font-size: var(--font-size-sm);
}

.filter-group {
  display: flex;
  gap: var(--space-8);
  align-items: center;
}

.filter-select {
  padding: var(--space-8) var(--space-12);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  background-color: var(--color-surface);
  color: var(--color-text);
  font-size: var(--font-size-sm);
  cursor: pointer;
  transition: border-color var(--duration-fast) var(--ease-standard);
}

.filter-select:focus {
  border-color: var(--color-primary);
  outline: none;
  box-shadow: var(--focus-ring);
}

.table {
  width: 100%;
  border-collapse: collapse;
}

.table thead {
  background-color: var(--color-background);
  border-bottom: 1px solid var(--color-border);
}

.table th {
  text-align: left;
  padding: var(--space-12) var(--space-16);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.table td {
  padding: var(--space-16);
  border-bottom: 1px solid var(--color-card-border-inner);
  color: var(--color-text);
  font-size: var(--font-size-sm);
}

.table tbody tr {
  transition: background-color var(--duration-fast) var(--ease-standard);
  cursor: pointer;
}

.table tbody tr:hover {
  background-color: var(--color-secondary);
}

.badge {
  display: inline-flex;
  align-items: center;
  padding: var(--space-4) var(--space-10);
  border-radius: var(--radius-full);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-medium);
  border: 1px solid;
}

.badge-critical {
  background-color: rgba(239, 68, 68, 0.1);
  color: #dc2626;
  border-color: rgba(239, 68, 68, 0.3);
}

.badge-high {
  background-color: rgba(249, 115, 22, 0.1);
  color: #ea580c;
  border-color: rgba(249, 115, 22, 0.3);
}

.badge-medium {
  background-color: rgba(245, 158, 11, 0.1);
  color: #d97706;
  border-color: rgba(245, 158, 11, 0.3);
}

.badge-low {
  background-color: rgba(59, 130, 246, 0.1);
  color: #2563eb;
  border-color: rgba(59, 130, 246, 0.3);
}

.badge-open {
  background-color: rgba(239, 68, 68, 0.1);
  color: #dc2626;
  border-color: rgba(239, 68, 68, 0.3);
}

.badge-in-progress {
  background-color: rgba(245, 158, 11, 0.1);
  color: #d97706;
  border-color: rgba(245, 158, 11, 0.3);
}

.badge-resolved {
  background-color: rgba(34, 197, 94, 0.1);
  color: #16a34a;
  border-color: rgba(34, 197, 94, 0.3);
}

.badge-closed {
  background-color: rgba(107, 114, 128, 0.1);
  color: #6b7280;
  border-color: rgba(107, 114, 128, 0.3);
}

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-10) var(--space-16);
  border-radius: var(--radius-base);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: all var(--duration-normal) var(--ease-standard);
  border: none;
  gap: var(--space-8);
}

.btn-primary {
  background-color: var(--color-primary);
  color: var(--color-btn-primary-text);
}

.btn-primary:hover {
  background-color: var(--color-primary-hover);
}

.btn-secondary {
  background-color: var(--color-secondary);
  color: var(--color-text);
  border: 1px solid var(--color-border);
}

.btn-secondary:hover {
  background-color: var(--color-secondary-hover);
}

.btn-sm {
  padding: var(--space-6) var(--space-12);
  font-size: var(--font-size-xs);
}

/* Detail View */
.detail-container {
  max-width: 1000px;
  margin: 0 auto;
}

.detail-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: var(--space-24);
  gap: var(--space-16);
  flex-wrap: wrap;
}

.detail-title-section {
  flex: 1;
}

.detail-title {
  font-size: var(--font-size-3xl);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  margin-bottom: var(--space-8);
}

.detail-meta {
  display: flex;
  gap: var(--space-16);
  flex-wrap: wrap;
  margin-top: var(--space-12);
}

.meta-item {
  display: flex;
  align-items: center;
  gap: var(--space-6);
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
}

.detail-actions {
  display: flex;
  gap: var(--space-8);
  flex-wrap: wrap;
}

.detail-card {
  background-color: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  padding: var(--space-24);
  margin-bottom: var(--space-16);
}

.detail-card-title {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  margin-bottom: var(--space-16);
}

.detail-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--space-16);
}

.detail-field {
  margin-bottom: var(--space-16);
}

.field-label {
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-6);
}

.field-value {
  color: var(--color-text);
  font-size: var(--font-size-base);
}

.solution-item {
  padding: var(--space-16);
  background-color: var(--color-background);
  border-radius: var(--radius-base);
  margin-bottom: var(--space-12);
}

.solution-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: var(--space-12);
}

.solution-title {
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  font-size: var(--font-size-base);
}

.solution-time {
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
}

.solution-description {
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  line-height: 1.6;
}

/* Timeline */
.timeline {
  position: relative;
  padding-left: var(--space-24);
}

.timeline::before {
  content: '';
  position: absolute;
  left: 4px;
  top: 0;
  bottom: 0;
  width: 2px;
  background-color: var(--color-border);
}

.timeline-item {
  position: relative;
  margin-bottom: var(--space-20);
}

.timeline-marker {
  position: absolute;
  left: -20px;
  width: 10px;
  height: 10px;
  border-radius: var(--radius-full);
  background-color: var(--color-primary);
  border: 2px solid var(--color-surface);
}

.timeline-content {
  background-color: var(--color-background);
  padding: var(--space-12);
  border-radius: var(--radius-base);
}

.timeline-title {
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  margin-bottom: var(--space-4);
  font-size: var(--font-size-sm);
}

.timeline-time {
  color: var(--color-text-secondary);
  font-size: var(--font-size-xs);
}

/* Export Page */
.export-options {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: var(--space-16);
  margin-bottom: var(--space-24);
}

.export-card {
  background-color: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  padding: var(--space-24);
  text-align: center;
  cursor: pointer;
  transition: all var(--duration-normal) var(--ease-standard);
}

.export-card:hover {
  border-color: var(--color-primary);
  box-shadow: var(--shadow-md);
}

.export-icon {
  width: 48px;
  height: 48px;
  margin: 0 auto var(--space-16);
  background-color: var(--color-bg-1);
  border-radius: var(--radius-base);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--font-size-2xl);
}

.export-title {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  margin-bottom: var(--space-8);
}

.export-description {
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
}

/* Lessons Learned */
.lesson-card {
  background-color: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  padding: var(--space-20);
  margin-bottom: var(--space-16);
}

.lesson-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: var(--space-12);
}

.lesson-incident {
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  font-size: var(--font-size-base);
}

.lesson-type {
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  background-color: var(--color-bg-2);
  padding: var(--space-4) var(--space-8);
  border-radius: var(--radius-sm);
}

.lesson-content {
  margin-bottom: var(--space-12);
}

.lesson-label {
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-secondary);
  text-transform: uppercase;
  margin-bottom: var(--space-4);
}

.lesson-text {
  color: var(--color-text);
  font-size: var(--font-size-sm);
  line-height: 1.6;
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: var(--space-32);
  color: var(--color-text-secondary);
}

.empty-icon {
  font-size: 48px;
  margin-bottom: var(--space-16);
  opacity: 0.5;
}

.empty-title {
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  margin-bottom: var(--space-8);
}

.empty-description {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-16);
}

/* Pagination */
.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: var(--space-8);
  padding: var(--space-20);
  border-top: 1px solid var(--color-border);
}

.pagination-btn {
  padding: var(--space-6) var(--space-12);
  border: 1px solid var(--color-border);
  background-color: var(--color-surface);
  color: var(--color-text);
  border-radius: var(--radius-base);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-standard);
  font-size: var(--font-size-sm);
}

.pagination-btn:hover:not(:disabled) {
  background-color: var(--color-secondary);
}

.pagination-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.pagination-btn.active {
  background-color: var(--color-primary);
  color: var(--color-btn-primary-text);
  border-color: var(--color-primary);
}

/* Loading State */
.loading {
  text-align: center;
  padding: var(--space-32);
}

.spinner {
  width: 40px;
  height: 40px;
  border: 3px solid var(--color-border);
  border-top-color: var(--color-primary);
  border-radius: var(--radius-full);
  animation: spin 0.8s linear infinite;
  margin: 0 auto var(--space-16);
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Toast Notification */
.toast {
  position: fixed;
  bottom: var(--space-24);
  right: var(--space-24);
  background-color: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  padding: var(--space-16);
  box-shadow: var(--shadow-lg);
  min-width: 300px;
  z-index: 1000;
  animation: slideIn 0.3s var(--ease-standard);
}

@keyframes slideIn {
  from {
    transform: translateX(400px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

.toast-content {
  display: flex;
  align-items: flex-start;
  gap: var(--space-12);
}

.toast-icon {
  font-size: var(--font-size-xl);
}

.toast-message {
  flex: 1;
}

.toast-title {
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  margin-bottom: var(--space-4);
  font-size: var(--font-size-sm);
}

.toast-text {
  color: var(--color-text-secondary);
  font-size: var(--font-size-xs);
}

.toast-close {
  background: none;
  border: none;
  cursor: pointer;
  color: var(--color-text-secondary);
  font-size: var(--font-size-xl);
  line-height: 1;
  padding: 0;
}

/* Responsive */
@media (max-width: 768px) {
  .sidebar {
    position: fixed;
    left: 0;
    top: 0;
    bottom: 0;
    z-index: 100;
    transform: translateX(-100%);
  }

  .sidebar.open {
    transform: translateX(0);
  }

  .menu-toggle {
    display: block;
  }

  .stats-grid {
    grid-template-columns: 1fr;
  }

  .table-header {
    flex-direction: column;
    align-items: stretch;
  }

  .table-actions {
    flex-direction: column;
  }

  .search-box {
    width: 100%;
  }

  .table {
    font-size: var(--font-size-xs);
  }

  .table th,
  .table td {
    padding: var(--space-8);
  }

  .detail-header {
    flex-direction: column;
  }

  .export-options {
    grid-template-columns: 1fr;
  }

  .toast {
    left: var(--space-16);
    right: var(--space-16);
    min-width: auto;
  }
}

.hidden {
  display: none;
}

/* AI Chat Assistant Styles */
.chat-float-button {
  position: fixed;
  bottom: var(--space-24);
  right: var(--space-24);
  width: 60px;
  height: 60px;
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
  border-radius: var(--radius-full);
  border: none;
  cursor: pointer;
  box-shadow: var(--shadow-lg);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--font-size-2xl);
  transition: all var(--duration-normal) var(--ease-standard);
  z-index: 999;
  animation: bounceIn 0.6s var(--ease-standard);
}

.chat-float-button:hover {
  transform: scale(1.1);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
}

.chat-float-button:active {
  transform: scale(0.95);
}

@keyframes bounceIn {
  0% {
    transform: scale(0);
    opacity: 0;
  }
  50% {
    transform: scale(1.1);
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

.chat-badge {
  position: absolute;
  top: -4px;
  right: -4px;
  background: var(--color-error);
  color: white;
  font-size: 10px;
  padding: 2px 6px;
  border-radius: var(--radius-full);
  font-weight: var(--font-weight-bold);
}

.chat-panel {
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  width: 400px;
  background: var(--color-surface);
  border-left: 1px solid var(--color-border);
  display: flex;
  flex-direction: column;
  z-index: 1000;
  transform: translateX(100%);
  transition: transform var(--duration-normal) var(--ease-standard);
  box-shadow: -4px 0 12px rgba(0, 0, 0, 0.1);
}

.chat-panel.open {
  transform: translateX(0);
}

.chat-header {
  padding: var(--space-20) var(--space-16);
  border-bottom: 1px solid var(--color-border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--color-background);
}

.chat-header-title {
  display: flex;
  align-items: center;
  gap: var(--space-12);
}

.chat-avatar {
  width: 36px;
  height: 36px;
  background: var(--color-primary);
  border-radius: var(--radius-full);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--font-size-lg);
}

.chat-title-text h3 {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  margin-bottom: 2px;
}

.chat-status {
  font-size: var(--font-size-xs);
  color: var(--color-success);
  display: flex;
  align-items: center;
  gap: 4px;
}

.status-dot {
  width: 6px;
  height: 6px;
  background: var(--color-success);
  border-radius: var(--radius-full);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.chat-close {
  background: none;
  border: none;
  color: var(--color-text-secondary);
  cursor: pointer;
  font-size: 24px;
  line-height: 1;
  padding: var(--space-4);
  border-radius: var(--radius-base);
  transition: all var(--duration-fast) var(--ease-standard);
}

.chat-close:hover {
  background: var(--color-secondary);
  color: var(--color-text);
}

.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: var(--space-16);
  display: flex;
  flex-direction: column;
  gap: var(--space-16);
}

.chat-message {
  display: flex;
  gap: var(--space-12);
  animation: fadeInUp 0.3s var(--ease-standard);
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.chat-message.user {
  flex-direction: row-reverse;
}

.message-avatar {
  width: 32px;
  height: 32px;
  border-radius: var(--radius-full);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-semibold);
}

.message-avatar.ai {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
}

.message-avatar.user {
  background: var(--color-secondary);
  color: var(--color-text);
}

.message-content {
  max-width: 75%;
  display: flex;
  flex-direction: column;
  gap: var(--space-8);
}

.message-bubble {
  padding: var(--space-12) var(--space-16);
  border-radius: var(--radius-lg);
  font-size: 15px;
  line-height: 1.5;
}

.chat-message.ai .message-bubble {
  background: var(--color-background);
  color: var(--color-text);
  border: 1px solid var(--color-card-border);
}

.chat-message.user .message-bubble {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
}

.message-time {
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  padding: 0 var(--space-4);
}

.incident-card {
  background: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-base);
  padding: var(--space-12);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-standard);
}

.incident-card:hover {
  border-color: var(--color-primary);
  box-shadow: var(--shadow-sm);
}

.incident-card-header {
  display: flex;
  justify-content: space-between;
  align-items: start;
  margin-bottom: var(--space-8);
}

.incident-card-title {
  font-weight: var(--font-weight-semibold);
  font-size: var(--font-size-sm);
  color: var(--color-text);
}

.incident-card-meta {
  display: flex;
  gap: var(--space-8);
  margin-top: var(--space-4);
}

.typing-indicator {
  display: flex;
  gap: 4px;
  padding: var(--space-12) var(--space-16);
  background: var(--color-background);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  width: fit-content;
}

.typing-dot {
  width: 8px;
  height: 8px;
  background: var(--color-text-secondary);
  border-radius: var(--radius-full);
  animation: typing 1.4s infinite;
}

.typing-dot:nth-child(2) {
  animation-delay: 0.2s;
}

.typing-dot:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes typing {
  0%, 60%, 100% {
    transform: translateY(0);
    opacity: 0.7;
  }
  30% {
    transform: translateY(-10px);
    opacity: 1;
  }
}

.quick-actions {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-8);
}

.quick-action-btn {
  padding: var(--space-8) var(--space-12);
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-full);
  font-size: var(--font-size-sm);
  color: var(--color-text);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-standard);
  white-space: nowrap;
}

.quick-action-btn:hover {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
  border-color: var(--color-primary);
}

.chat-input-container {
  padding: var(--space-16);
  border-top: 1px solid var(--color-border);
  background: var(--color-background);
}

.chat-input-wrapper {
  display: flex;
  gap: var(--space-8);
  align-items: flex-end;
}

.chat-input {
  flex: 1;
  padding: var(--space-12) var(--space-16);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  background: var(--color-surface);
  color: var(--color-text);
  font-size: 15px;
  font-family: var(--font-family-base);
  resize: none;
  max-height: 120px;
  min-height: 44px;
  line-height: 1.5;
}

.chat-input:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: var(--focus-ring);
}

.chat-send-btn {
  width: 44px;
  height: 44px;
  min-width: 44px;
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
  border: none;
  border-radius: var(--radius-lg);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--font-size-xl);
  transition: all var(--duration-fast) var(--ease-standard);
}

.chat-send-btn:hover:not(:disabled) {
  background: var(--color-primary-hover);
  transform: scale(1.05);
}

.chat-send-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.chat-welcome {
  text-align: center;
  padding: var(--space-32) var(--space-16);
}

.chat-welcome-icon {
  font-size: 48px;
  margin-bottom: var(--space-16);
}

.chat-welcome-title {
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  margin-bottom: var(--space-8);
}

.chat-welcome-text {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-24);
  line-height: 1.6;
}

.chat-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 999;
}

.chat-overlay.visible {
  display: block;
}

/* Mobile Bottom Navigation */
.mobile-nav {
  display: none;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--color-surface);
  border-top: 1px solid var(--color-border);
  padding: var(--space-8) var(--space-8) calc(var(--space-8) + env(safe-area-inset-bottom));
  z-index: 98;
}

.mobile-nav-items {
  display: flex;
  justify-content: space-around;
  align-items: center;
}

.mobile-nav-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--space-4);
  padding: var(--space-8);
  color: var(--color-text-secondary);
  cursor: pointer;
  transition: color var(--duration-fast) var(--ease-standard);
  min-width: 64px;
}

.mobile-nav-item.active {
  color: var(--color-primary);
}

.mobile-nav-icon {
  font-size: var(--font-size-2xl);
}

.mobile-nav-label {
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-medium);
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .chat-panel {
    width: 100%;
    border-left: none;
  }

  .chat-float-button {
    display: none;
  }

  .mobile-nav {
    display: block;
  }

  .content-area {
    padding-bottom: 80px;
  }

  .message-content {
    max-width: 85%;
  }

  .chat-input-wrapper {
    gap: var(--space-8);
  }

  .chat-welcome {
    padding: var(--space-24) var(--space-16);
  }
}

@media (min-width: 769px) {
  .chat-overlay.visible {
    display: none;
  }
}
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">N</div>
                    <div class="logo-text">NoteByPine MCP</div>
                </div>
            </div>
            <nav class="nav-menu">
                <div class="nav-item active" data-page="dashboard">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                    </svg>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" data-page="incidents">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                    </svg>
                    <span>Incidents</span>
                </div>
                <div class="nav-item" data-page="solutions">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>Solutions</span>
                </div>
                <div class="nav-item" data-page="knowledge">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                    <span>Knowledge Base</span>
                </div>
                <div class="nav-item" data-page="settings">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    <span>Settings</span>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="top-bar-left">
                    <button class="menu-toggle" id="menuToggle">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                    <h1 class="page-title" id="pageTitle">Dashboard</h1>
                </div>
                <div class="top-bar-right">
                    <div class="user-profile">
                        <div class="user-avatar">A</div>
                        <span>Admin</span>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area" id="contentArea">
                <!-- Content will be dynamically loaded here -->
            </div>
        </div>
    </div>

    <!-- AI Chat Assistant -->
    <button class="chat-float-button" id="chatFloatBtn" title="Open AI Assistant">
        ü§ñ
        <span class="chat-badge">AI</span>
    </button>

    <div class="chat-overlay" id="chatOverlay"></div>

    <div class="chat-panel" id="chatPanel">
        <div class="chat-header">
            <div class="chat-header-title">
                <div class="chat-avatar">ü§ñ</div>
                <div class="chat-title-text">
                    <h3>AI Assistant</h3>
                    <div class="chat-status">
                        <span class="status-dot"></span>
                        Online
                    </div>
                </div>
            </div>
            <button class="chat-close" id="chatCloseBtn">√ó</button>
        </div>

        <div class="chat-messages" id="chatMessages">
            <!-- Messages will be dynamically added here -->
        </div>

        <div class="chat-input-container">
            <div class="chat-input-wrapper">
                <textarea 
                    class="chat-input" 
                    id="chatInput" 
                    placeholder="Ask me anything about incidents..."
                    rows="1"
                ></textarea>
                <button class="chat-send-btn" id="chatSendBtn">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <div class="mobile-nav" id="mobileNav">
        <div class="mobile-nav-items">
            <div class="mobile-nav-item active" data-page="dashboard">
                <div class="mobile-nav-icon">üè†</div>
                <div class="mobile-nav-label">Dashboard</div>
            </div>
            <div class="mobile-nav-item" data-page="incidents">
                <div class="mobile-nav-icon">‚ö†Ô∏è</div>
                <div class="mobile-nav-label">Incidents</div>
            </div>
            <div class="mobile-nav-item" id="mobileChat">
                <div class="mobile-nav-icon">üí¨</div>
                <div class="mobile-nav-label">AI Chat</div>
            </div>
        </div>
    </div>

    <script>
        // Application State
        const appState = {
            currentPage: 'dashboard',
            currentIncident: null,
            filters: {
                category: 'all',
                severity: 'all',
                status: 'all',
                search: ''
            },
            currentPage_pagination: 1,
            itemsPerPage: 10,
            chatOpen: false,
            chatMessages: [],
            isTyping: false
        };

        // Sample Data
        const incidents = [
            {
                id: 'INC-001',
                title: 'Database Connection Timeout',
                category: 'Database',
                severity: 'Critical',
                status: 'open',
                created: '2025-11-07',
                description: 'Connection to production database times out during peak hours',
                symptoms: 'Slow queries, connection refused errors',
                context: 'Peak traffic hours 2-4 PM',
                environment: 'Production',
                frequency: 'Daily',
                solutions: [
                    {
                        title: 'Increase connection pool',
                        description: 'Increase max connections from 50 to 200',
                        time_estimate: '2 hours'
                    }
                ]
            },
            {
                id: 'INC-002',
                title: 'Memory Leak in Cache Service',
                category: 'Performance',
                severity: 'High',
                status: 'in-progress',
                created: '2025-11-06',
                description: 'Memory usage grows by 5MB per hour',
                symptoms: 'Increasing memory consumption',
                context: 'Cache service running 24/7',
                environment: 'Production',
                frequency: 'Continuous',
                solutions: [
                    {
                        title: 'Implement cache eviction policy',
                        description: 'Add TTL-based cache eviction',
                        time_estimate: '4 hours'
                    }
                ]
            },
            {
                id: 'INC-003',
                title: 'Authentication API Rate Limit Exceeded',
                category: 'API',
                severity: 'Medium',
                status: 'resolved',
                created: '2025-11-05',
                description: 'Rate limiter blocking legitimate requests',
                symptoms: '429 errors on authentication endpoint',
                context: 'High user login activity',
                environment: 'Production',
                frequency: 'Occasional',
                solutions: []
            },
            {
                id: 'INC-004',
                title: 'Missing Log Rotation',
                category: 'System',
                severity: 'Low',
                status: 'resolved',
                created: '2025-11-04',
                description: 'Log files consuming 90GB of disk space',
                symptoms: 'Low disk space warnings',
                context: 'Log files not rotating',
                environment: 'Production',
                frequency: 'One-time',
                solutions: []
            }
        ];

        const lessonsLearned = [
            {
                incident: 'INC-001',
                lesson: 'Implement better connection pooling and monitoring',
                prevention: 'Set up automated alerts for connection timeouts',
                type: 'Process Improvement'
            },
            {
                incident: 'INC-002',
                lesson: 'Cache needs proper memory management',
                prevention: 'Implement health checks for cache service',
                type: 'Best Practice'
            }
        ];

        // Utility Functions
        function getSeverityClass(severity) {
            return `badge-${severity.toLowerCase()}`;
        }

        function getStatusClass(status) {
            return `badge-${status.toLowerCase()}`;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        }

        function showToast(title, message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <div class="toast-content">
                    <div class="toast-icon">${type === 'success' ? '‚úì' : '!'}</div>
                    <div class="toast-message">
                        <div class="toast-title">${title}</div>
                        <div class="toast-text">${message}</div>
                    </div>
                    <button class="toast-close" onclick="this.parentElement.parentElement.remove()">√ó</button>
                </div>
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Filter and Search Functions
        function getFilteredIncidents() {
            return incidents.filter(incident => {
                const matchesCategory = appState.filters.category === 'all' || incident.category === appState.filters.category;
                const matchesSeverity = appState.filters.severity === 'all' || incident.severity === appState.filters.severity;
                const matchesStatus = appState.filters.status === 'all' || incident.status === appState.filters.status;
                const matchesSearch = appState.filters.search === '' || 
                    incident.title.toLowerCase().includes(appState.filters.search.toLowerCase()) ||
                    incident.id.toLowerCase().includes(appState.filters.search.toLowerCase());
                return matchesCategory && matchesSeverity && matchesStatus && matchesSearch;
            });
        }

        // Page Renderers
        function renderDashboard() {
            const openIncidents = incidents.filter(i => i.status === 'open').length;
            const resolvedIncidents = incidents.filter(i => i.status === 'resolved').length;
            const criticalCount = incidents.filter(i => i.severity === 'Critical').length;
            const highCount = incidents.filter(i => i.severity === 'High').length;
            const mediumCount = incidents.filter(i => i.severity === 'Medium').length;
            const lowCount = incidents.filter(i => i.severity === 'Low').length;

            return `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-label">Total Incidents</div>
                                <div class="stat-value">${incidents.length}</div>
                                <div class="stat-change">All time</div>
                            </div>
                            <div class="stat-icon" style="background-color: var(--color-bg-1); color: #3b82f6;">üìä</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-label">Open Incidents</div>
                                <div class="stat-value">${openIncidents}</div>
                                <div class="stat-change">Requires attention</div>
                            </div>
                            <div class="stat-icon" style="background-color: var(--color-bg-4); color: #ef4444;">üö®</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-label">Resolved</div>
                                <div class="stat-value">${resolvedIncidents}</div>
                                <div class="stat-change">Completed</div>
                            </div>
                            <div class="stat-icon" style="background-color: var(--color-bg-3); color: #22c55e;">‚úì</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-label">In Progress</div>
                                <div class="stat-value">${incidents.filter(i => i.status === 'in-progress').length}</div>
                                <div class="stat-change">Being worked on</div>
                            </div>
                            <div class="stat-icon" style="background-color: var(--color-bg-2); color: #f59e0b;">‚è≥</div>
                        </div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label" style="margin-bottom: 12px;">Severity Distribution</div>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span class="badge badge-critical">Critical</span>
                                <span style="font-weight: 600;">${criticalCount}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span class="badge badge-high">High</span>
                                <span style="font-weight: 600;">${highCount}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span class="badge badge-medium">Medium</span>
                                <span style="font-weight: 600;">${mediumCount}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span class="badge badge-low">Low</span>
                                <span style="font-weight: 600;">${lowCount}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Recent Incidents</h2>
                        <button class="btn btn-primary" onclick="navigateToPage('incidents')">
                            View All Incidents ‚Üí
                        </button>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Title</th>
                                <th>Category</th>
                                <th>Severity</th>
                                <th>Status</th>
                                <th>Created</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${incidents.slice(0, 5).map(incident => `
                                <tr onclick="viewIncidentDetail('${incident.id}')">
                                    <td><strong>${incident.id}</strong></td>
                                    <td>${incident.title}</td>
                                    <td>${incident.category}</td>
                                    <td><span class="badge ${getSeverityClass(incident.severity)}">${incident.severity}</span></td>
                                    <td><span class="badge ${getStatusClass(incident.status)}">${incident.status}</span></td>
                                    <td>${formatDate(incident.created)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function renderIncidents() {
            const filteredIncidents = getFilteredIncidents();
            const totalPages = Math.ceil(filteredIncidents.length / appState.itemsPerPage);
            const startIndex = (appState.currentPage_pagination - 1) * appState.itemsPerPage;
            const endIndex = startIndex + appState.itemsPerPage;
            const paginatedIncidents = filteredIncidents.slice(startIndex, endIndex);

            return `
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">All Incidents</h2>
                        <div class="table-actions">
                            <div class="search-box">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                                <input type="text" placeholder="Search incidents..." id="searchInput" value="${appState.filters.search}">
                            </div>
                            <div class="filter-group">
                                <select class="filter-select" id="categoryFilter">
                                    <option value="all">All Categories</option>
                                    <option value="Database">Database</option>
                                    <option value="API">API</option>
                                    <option value="Performance">Performance</option>
                                    <option value="Security">Security</option>
                                    <option value="System">System</option>
                                    <option value="Frontend">Frontend</option>
                                </select>
                                <select class="filter-select" id="severityFilter">
                                    <option value="all">All Severities</option>
                                    <option value="Critical">Critical</option>
                                    <option value="High">High</option>
                                    <option value="Medium">Medium</option>
                                    <option value="Low">Low</option>
                                </select>
                                <select class="filter-select" id="statusFilter">
                                    <option value="all">All Statuses</option>
                                    <option value="open">Open</option>
                                    <option value="in-progress">In Progress</option>
                                    <option value="resolved">Resolved</option>
                                    <option value="closed">Closed</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="showToast('Feature Coming Soon', 'Add new incident functionality will be available soon')">
                                + Add Incident
                            </button>
                        </div>
                    </div>
                    ${paginatedIncidents.length > 0 ? `
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Severity</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${paginatedIncidents.map(incident => `
                                    <tr onclick="viewIncidentDetail('${incident.id}')">
                                        <td><strong>${incident.id}</strong></td>
                                        <td>${incident.title}</td>
                                        <td>${incident.category}</td>
                                        <td><span class="badge ${getSeverityClass(incident.severity)}">${incident.severity}</span></td>
                                        <td><span class="badge ${getStatusClass(incident.status)}">${incident.status}</span></td>
                                        <td>${formatDate(incident.created)}</td>
                                        <td>
                                            <button class="btn btn-sm btn-secondary" onclick="event.stopPropagation(); viewIncidentDetail('${incident.id}')">
                                                View
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        ${totalPages > 1 ? `
                            <div class="pagination">
                                <button class="pagination-btn" onclick="changePage(${appState.currentPage_pagination - 1})" ${appState.currentPage_pagination === 1 ? 'disabled' : ''}>
                                    Previous
                                </button>
                                ${Array.from({length: totalPages}, (_, i) => i + 1).map(page => `
                                    <button class="pagination-btn ${page === appState.currentPage_pagination ? 'active' : ''}" onclick="changePage(${page})">
                                        ${page}
                                    </button>
                                `).join('')}
                                <button class="pagination-btn" onclick="changePage(${appState.currentPage_pagination + 1})" ${appState.currentPage_pagination === totalPages ? 'disabled' : ''}>
                                    Next
                                </button>
                            </div>
                        ` : ''}
                    ` : `
                        <div class="empty-state">
                            <div class="empty-icon">üîç</div>
                            <div class="empty-title">No incidents found</div>
                            <div class="empty-description">Try adjusting your filters or search query</div>
                        </div>
                    `}
                </div>
            `;
        }

        function renderIncidentDetail() {
            const incident = incidents.find(i => i.id === appState.currentIncident);
            if (!incident) return '<div class="empty-state"><div class="empty-title">Incident not found</div></div>';

            return `
                <div class="detail-container">
                    <button class="btn btn-secondary" onclick="navigateToPage('incidents')" style="margin-bottom: 24px;">
                        ‚Üê Back to Incidents
                    </button>

                    <div class="detail-header">
                        <div class="detail-title-section">
                            <div class="detail-title">${incident.title}</div>
                            <div class="detail-meta">
                                <div class="meta-item">
                                    <strong>ID:</strong> ${incident.id}
                                </div>
                                <div class="meta-item">
                                    <strong>Created:</strong> ${formatDate(incident.created)}
                                </div>
                                <div class="meta-item">
                                    <span class="badge ${getSeverityClass(incident.severity)}">${incident.severity}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="badge ${getStatusClass(incident.status)}">${incident.status}</span>
                                </div>
                            </div>
                        </div>
                        <div class="detail-actions">
                            <button class="btn btn-primary" onclick="showToast('Status Updated', 'Incident status has been updated')">
                                Update Status
                            </button>
                            <button class="btn btn-secondary" onclick="showToast('Edit Mode', 'Edit functionality will open incident form')">
                                Edit
                            </button>
                        </div>
                    </div>

                    <div class="detail-card">
                        <div class="detail-card-title">Incident Details</div>
                        <div class="detail-grid">
                            <div class="detail-field">
                                <div class="field-label">Category</div>
                                <div class="field-value">${incident.category}</div>
                            </div>
                            <div class="detail-field">
                                <div class="field-label">Environment</div>
                                <div class="field-value">${incident.environment}</div>
                            </div>
                            <div class="detail-field">
                                <div class="field-label">Frequency</div>
                                <div class="field-value">${incident.frequency}</div>
                            </div>
                        </div>
                        <div class="detail-field">
                            <div class="field-label">Description</div>
                            <div class="field-value">${incident.description}</div>
                        </div>
                        <div class="detail-field">
                            <div class="field-label">Symptoms</div>
                            <div class="field-value">${incident.symptoms}</div>
                        </div>
                        <div class="detail-field">
                            <div class="field-label">Context</div>
                            <div class="field-value">${incident.context}</div>
                        </div>
                    </div>

                    <div class="detail-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <div class="detail-card-title" style="margin-bottom: 0;">Solutions</div>
                            <button class="btn btn-sm btn-primary" onclick="showToast('Solution Added', 'New solution has been added to this incident')">
                                + Add Solution
                            </button>
                        </div>
                        ${incident.solutions.length > 0 ? incident.solutions.map(solution => `
                            <div class="solution-item">
                                <div class="solution-header">
                                    <div class="solution-title">${solution.title}</div>
                                    <div class="solution-time">‚è± ${solution.time_estimate}</div>
                                </div>
                                <div class="solution-description">${solution.description}</div>
                            </div>
                        `).join('') : `
                            <div class="empty-state" style="padding: 32px;">
                                <div class="empty-title" style="font-size: 16px;">No solutions yet</div>
                                <div class="empty-description">Add a solution to help resolve this incident</div>
                            </div>
                        `}
                    </div>

                    <div class="detail-card">
                        <div class="detail-card-title">Lessons Learned</div>
                        ${lessonsLearned.filter(l => l.incident === incident.id).length > 0 ? 
                            lessonsLearned.filter(l => l.incident === incident.id).map(lesson => `
                                <div class="detail-field">
                                    <div class="field-label">Lesson</div>
                                    <div class="field-value">${lesson.lesson}</div>
                                </div>
                                <div class="detail-field">
                                    <div class="field-label">Prevention</div>
                                    <div class="field-value">${lesson.prevention}</div>
                                </div>
                            `).join('') : `
                            <div class="empty-state" style="padding: 32px;">
                                <div class="empty-title" style="font-size: 16px;">No lessons learned documented</div>
                                <div class="empty-description">Document insights from this incident</div>
                            </div>
                        `}
                    </div>

                    <div class="detail-card">
                        <div class="detail-card-title">Activity Timeline</div>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <div class="timeline-title">Incident Created</div>
                                    <div class="timeline-time">${formatDate(incident.created)} at 10:30 AM</div>
                                </div>
                            </div>
                            ${incident.status !== 'open' ? `
                                <div class="timeline-item">
                                    <div class="timeline-marker"></div>
                                    <div class="timeline-content">
                                        <div class="timeline-title">Status changed to ${incident.status}</div>
                                        <div class="timeline-time">${formatDate(incident.created)} at 2:45 PM</div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderSolutions() {
            const incidentsWithSolutions = incidents.filter(i => i.solutions.length > 0);

            return `
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Solutions Management</h2>
                        <button class="btn btn-primary" onclick="showToast('Add Solution', 'Select an incident to add a solution')">
                            + Add Solution
                        </button>
                    </div>
                    ${incidentsWithSolutions.length > 0 ? `
                        <div style="padding: 24px;">
                            ${incidentsWithSolutions.map(incident => `
                                <div class="detail-card" style="margin-bottom: 16px;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                                        <div>
                                            <div style="font-weight: 600; margin-bottom: 4px;">${incident.title}</div>
                                            <div style="font-size: 12px; color: var(--color-text-secondary);">${incident.id} ‚Ä¢ ${incident.category}</div>
                                        </div>
                                        <span class="badge ${getSeverityClass(incident.severity)}">${incident.severity}</span>
                                    </div>
                                    ${incident.solutions.map(solution => `
                                        <div class="solution-item">
                                            <div class="solution-header">
                                                <div class="solution-title">${solution.title}</div>
                                                <div class="solution-time">‚è± ${solution.time_estimate}</div>
                                            </div>
                                            <div class="solution-description">${solution.description}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div class="empty-state">
                            <div class="empty-icon">üí°</div>
                            <div class="empty-title">No solutions yet</div>
                            <div class="empty-description">Solutions will appear here once they are added to incidents</div>
                        </div>
                    `}
                </div>
            `;
        }

        function renderKnowledge() {
            return `
                <div>
                    <div class="export-options">
                        <div class="export-card" onclick="exportData('json')">
                            <div class="export-icon" style="background-color: var(--color-bg-1);">üìÑ</div>
                            <div class="export-title">Export JSON</div>
                            <div class="export-description">Download all incident data in JSON format</div>
                        </div>
                        <div class="export-card" onclick="exportData('csv')">
                            <div class="export-icon" style="background-color: var(--color-bg-3);">üìä</div>
                            <div class="export-title">Export CSV</div>
                            <div class="export-description">Download incident data as CSV file</div>
                        </div>
                        <div class="export-card" onclick="exportData('markdown')">
                            <div class="export-icon" style="background-color: var(--color-bg-5);">üìù</div>
                            <div class="export-title">Export Markdown</div>
                            <div class="export-description">Generate markdown documentation</div>
                        </div>
                    </div>

                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Lessons Learned</h2>
                        </div>
                        <div style="padding: 24px;">
                            ${lessonsLearned.length > 0 ? lessonsLearned.map(lesson => {
                                const incident = incidents.find(i => i.id === lesson.incident);
                                return `
                                    <div class="lesson-card">
                                        <div class="lesson-header">
                                            <div>
                                                <div class="lesson-incident">${incident ? incident.title : lesson.incident}</div>
                                                <div style="color: var(--color-text-secondary); font-size: 12px; margin-top: 4px;">${lesson.incident}</div>
                                            </div>
                                            <div class="lesson-type">${lesson.type}</div>
                                        </div>
                                        <div class="lesson-content">
                                            <div class="lesson-label">Lesson</div>
                                            <div class="lesson-text">${lesson.lesson}</div>
                                        </div>
                                        <div class="lesson-content">
                                            <div class="lesson-label">Prevention</div>
                                            <div class="lesson-text">${lesson.prevention}</div>
                                        </div>
                                    </div>
                                `;
                            }).join('') : `
                                <div class="empty-state">
                                    <div class="empty-icon">üìö</div>
                                    <div class="empty-title">No lessons learned yet</div>
                                    <div class="empty-description">Document insights from incidents to build your knowledge base</div>
                                </div>
                            `}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderSettings() {
            return `
                <div class="detail-container">
                    <div class="detail-card">
                        <div class="detail-card-title">System Settings</div>
                        <div class="detail-field">
                            <div class="field-label">System Name</div>
                            <div class="field-value">NoteByPine MCP Incident Management</div>
                        </div>
                        <div class="detail-field">
                            <div class="field-label">Version</div>
                            <div class="field-value">1.0.0</div>
                        </div>
                        <div class="detail-field">
                            <div class="field-label">Last Updated</div>
                            <div class="field-value">November 7, 2025</div>
                        </div>
                    </div>

                    <div class="detail-card">
                        <div class="detail-card-title">User Preferences</div>
                        <div class="detail-field">
                            <div class="field-label">Theme</div>
                            <select class="filter-select" style="width: 100%; max-width: 300px;">
                                <option>Auto (System)</option>
                                <option>Light</option>
                                <option>Dark</option>
                            </select>
                        </div>
                        <div class="detail-field">
                            <div class="field-label">Notifications</div>
                            <select class="filter-select" style="width: 100%; max-width: 300px;">
                                <option>All Incidents</option>
                                <option>Critical Only</option>
                                <option>Disabled</option>
                            </select>
                        </div>
                    </div>

                    <div class="detail-card">
                        <div class="detail-card-title">About</div>
                        <p style="color: var(--color-text-secondary); line-height: 1.6;">
                            NoteByPine MCP Incident Management System helps teams track, manage, and learn from incidents.
                            Built with modern web technologies and designed for ease of use.
                        </p>
                    </div>
                </div>
            `;
        }

        // Navigation Functions
        function navigateToPage(page) {
            appState.currentPage = page;
            appState.currentPage_pagination = 1;
            
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === page) {
                    item.classList.add('active');
                }
            });

            // Update page title
            const titles = {
                dashboard: 'Dashboard',
                incidents: 'Incidents',
                solutions: 'Solutions',
                knowledge: 'Knowledge Base',
                settings: 'Settings'
            };
            document.getElementById('pageTitle').textContent = titles[page] || 'Dashboard';

            // Render content
            renderContent();

            // Close mobile menu
            document.getElementById('sidebar').classList.remove('open');
        }

        function viewIncidentDetail(incidentId) {
            appState.currentIncident = incidentId;
            navigateToPage('incident-detail');
        }

        function renderContent() {
            const contentArea = document.getElementById('contentArea');
            let content = '';

            switch (appState.currentPage) {
                case 'dashboard':
                    content = renderDashboard();
                    break;
                case 'incidents':
                    content = renderIncidents();
                    break;
                case 'incident-detail':
                    content = renderIncidentDetail();
                    break;
                case 'solutions':
                    content = renderSolutions();
                    break;
                case 'knowledge':
                    content = renderKnowledge();
                    break;
                case 'settings':
                    content = renderSettings();
                    break;
                default:
                    content = renderDashboard();
            }

            contentArea.innerHTML = content;

            // Attach event listeners after render
            attachEventListeners();
        }

        function attachEventListeners() {
            // Search input
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    appState.filters.search = e.target.value;
                    renderContent();
                });
            }

            // Filter selects
            const categoryFilter = document.getElementById('categoryFilter');
            if (categoryFilter) {
                categoryFilter.value = appState.filters.category;
                categoryFilter.addEventListener('change', (e) => {
                    appState.filters.category = e.target.value;
                    appState.currentPage_pagination = 1;
                    renderContent();
                });
            }

            const severityFilter = document.getElementById('severityFilter');
            if (severityFilter) {
                severityFilter.value = appState.filters.severity;
                severityFilter.addEventListener('change', (e) => {
                    appState.filters.severity = e.target.value;
                    appState.currentPage_pagination = 1;
                    renderContent();
                });
            }

            const statusFilter = document.getElementById('statusFilter');
            if (statusFilter) {
                statusFilter.value = appState.filters.status;
                statusFilter.addEventListener('change', (e) => {
                    appState.filters.status = e.target.value;
                    appState.currentPage_pagination = 1;
                    renderContent();
                });
            }
        }

        function changePage(page) {
            const filteredIncidents = getFilteredIncidents();
            const totalPages = Math.ceil(filteredIncidents.length / appState.itemsPerPage);
            
            if (page >= 1 && page <= totalPages) {
                appState.currentPage_pagination = page;
                renderContent();
            }
        }

        function exportData(format) {
            showToast('Export Started', `Preparing ${format.toUpperCase()} export...`);
            
            // Simulate export
            setTimeout(() => {
                showToast('Export Complete', `${format.toUpperCase()} file has been downloaded`);
            }, 1500);
        }

        // Initialize App
        document.addEventListener('DOMContentLoaded', () => {
            // Navigation event listeners
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    navigateToPage(item.dataset.page);
                });
            });

            // Mobile menu toggle
            document.getElementById('menuToggle').addEventListener('click', () => {
                document.getElementById('sidebar').classList.toggle('open');
            });

            // Initial render
            renderContent();

            // Initialize chat
            initializeChat();
        });

        // Chat System
        const chatResponses = {
            greeting: "Hi! I'm your incident management assistant. How can I help you today?",
            help: "I can help you with:\n‚Ä¢ Create and search incidents\n‚Ä¢ Filter by severity or status\n‚Ä¢ Update incident information\n‚Ä¢ Export data\n‚Ä¢ Find similar issues\n\nJust ask in plain language!",
            critical: "I found {count} critical incident(s). Here they are:",
            create: "I'll help you create a new incident. What's the issue you're experiencing?",
            export: "I can export incidents in JSON, CSV, or Markdown format. Which would you prefer?",
            unknown: "I'm not sure I understood that. Could you try rephrasing? Or pick one of the quick actions below."
        };

        const conversationStarters = [
            { label: "Show critical incidents", command: "show critical" },
            { label: "Create new incident", command: "create new" },
            { label: "This week's activity", command: "show this week" },
            { label: "Need help", command: "help" }
        ];

        function initializeChat() {
            const chatFloatBtn = document.getElementById('chatFloatBtn');
            const chatCloseBtn = document.getElementById('chatCloseBtn');
            const chatOverlay = document.getElementById('chatOverlay');
            const chatSendBtn = document.getElementById('chatSendBtn');
            const chatInput = document.getElementById('chatInput');
            const mobileChat = document.getElementById('mobileChat');

            // Show welcome message
            showWelcomeMessage();

            // Float button click
            chatFloatBtn.addEventListener('click', () => openChat());

            // Close button click
            chatCloseBtn.addEventListener('click', () => closeChat());

            // Overlay click (mobile)
            chatOverlay.addEventListener('click', () => closeChat());

            // Mobile chat button
            if (mobileChat) {
                mobileChat.addEventListener('click', () => openChat());
            }

            // Send message
            chatSendBtn.addEventListener('click', () => sendMessage());

            // Enter key to send
            chatInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Auto-resize textarea
            chatInput.addEventListener('input', (e) => {
                e.target.style.height = 'auto';
                e.target.style.height = Math.min(e.target.scrollHeight, 120) + 'px';
            });
        }

        function openChat() {
            appState.chatOpen = true;
            document.getElementById('chatPanel').classList.add('open');
            document.getElementById('chatOverlay').classList.add('visible');
            document.getElementById('chatInput').focus();
        }

        function closeChat() {
            appState.chatOpen = false;
            document.getElementById('chatPanel').classList.remove('open');
            document.getElementById('chatOverlay').classList.remove('visible');
        }

        function showWelcomeMessage() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML = `
                <div class="chat-welcome">
                    <div class="chat-welcome-icon">ü§ñ</div>
                    <div class="chat-welcome-title">Hi! I'm your AI Assistant</div>
                    <div class="chat-welcome-text">
                        I can help you manage incidents through natural conversation. 
                        Try asking me to show critical incidents or create a new one!
                    </div>
                    <div class="quick-actions">
                        ${conversationStarters.map(starter => `
                            <button class="quick-action-btn" onclick="handleQuickAction('${starter.command}')">
                                ${starter.label}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function addMessage(content, isUser = false, isCard = false) {
            const messagesContainer = document.getElementById('chatMessages');
            
            // Remove welcome message if exists
            const welcomeMsg = messagesContainer.querySelector('.chat-welcome');
            if (welcomeMsg) {
                welcomeMsg.remove();
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${isUser ? 'user' : 'ai'}`;
            
            const time = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-avatar ${isUser ? 'user' : 'ai'}">
                    ${isUser ? 'A' : 'ü§ñ'}
                </div>
                <div class="message-content">
                    <div class="message-bubble">${content}</div>
                    <div class="message-time">${time}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            appState.chatMessages.push({ content, isUser, time });
        }

        function showTypingIndicator() {
            const messagesContainer = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'chat-message ai';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="message-avatar ai">ü§ñ</div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addMessage(message, true);
            input.value = '';
            input.style.height = 'auto';
            
            // Process message
            processMessage(message);
        }

        function processMessage(message) {
            const lowerMessage = message.toLowerCase();
            
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                
                if (lowerMessage.includes('help')) {
                    addMessage(chatResponses.help);
                    addQuickActions();
                } else if (lowerMessage.includes('critical')) {
                    showCriticalIncidents();
                } else if (lowerMessage.includes('create') || lowerMessage.includes('new incident')) {
                    addMessage(chatResponses.create);
                    addMessage('Here are some quick options:', false);
                    addQuickActions([
                        { label: 'Database Issue', command: 'create database' },
                        { label: 'API Problem', command: 'create api' },
                        { label: 'Performance Issue', command: 'create performance' }
                    ]);
                } else if (lowerMessage.includes('export')) {
                    addMessage(chatResponses.export);
                    addQuickActions([
                        { label: 'Export JSON', command: 'export json' },
                        { label: 'Export CSV', command: 'export csv' },
                        { label: 'Export Markdown', command: 'export markdown' }
                    ]);
                } else if (lowerMessage.includes('this week') || lowerMessage.includes('recent')) {
                    showRecentActivity();
                } else if (lowerMessage.includes('show') && (lowerMessage.includes('all') || lowerMessage.includes('incident'))) {
                    addMessage(`I found ${incidents.length} total incidents. Here are the most recent:`);
                    showIncidentCards(incidents.slice(0, 3));
                } else {
                    addMessage(chatResponses.unknown);
                    addQuickActions();
                }
            }, 1000);
        }

        function handleQuickAction(command) {
            const input = document.getElementById('chatInput');
            input.value = command;
            sendMessage();
        }

        function addQuickActions(actions = conversationStarters) {
            const messagesContainer = document.getElementById('chatMessages');
            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'chat-message ai';
            actionsDiv.innerHTML = `
                <div class="message-avatar ai">ü§ñ</div>
                <div class="message-content">
                    <div class="quick-actions">
                        ${actions.map(action => `
                            <button class="quick-action-btn" onclick="handleQuickAction('${action.command}')">
                                ${action.label}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
            messagesContainer.appendChild(actionsDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showCriticalIncidents() {
            const criticalIncidents = incidents.filter(i => i.severity === 'Critical');
            
            if (criticalIncidents.length === 0) {
                addMessage('Good news! There are no critical incidents at the moment. üéâ');
            } else {
                addMessage(`I found ${criticalIncidents.length} critical incident(s). Here they are:`);
                showIncidentCards(criticalIncidents);
            }
        }

        function showRecentActivity() {
            const recentIncidents = incidents.slice(0, 3);
            const openCount = incidents.filter(i => i.status === 'open').length;
            const resolvedToday = incidents.filter(i => i.status === 'resolved' && i.created === '2025-11-07').length;
            
            addMessage(`Here's your activity summary:\n\nüìä Total incidents: ${incidents.length}\nüö® Open: ${openCount}\n‚úÖ Resolved today: ${resolvedToday}\n\nRecent incidents:`);
            showIncidentCards(recentIncidents);
        }

        function showIncidentCards(incidentList) {
            const messagesContainer = document.getElementById('chatMessages');
            
            incidentList.forEach(incident => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'chat-message ai';
                cardDiv.innerHTML = `
                    <div class="message-avatar ai">ü§ñ</div>
                    <div class="message-content">
                        <div class="incident-card" onclick="viewIncidentDetailFromChat('${incident.id}')">
                            <div class="incident-card-header">
                                <div>
                                    <div class="incident-card-title">${incident.title}</div>
                                    <div class="incident-card-meta">
                                        <span class="badge ${getSeverityClass(incident.severity)}">${incident.severity}</span>
                                        <span class="badge ${getStatusClass(incident.status)}">${incident.status}</span>
                                    </div>
                                </div>
                            </div>
                            <div style="font-size: 11px; color: var(--color-text-secondary); margin-top: 8px;">
                                ${incident.id} ‚Ä¢ ${incident.category} ‚Ä¢ ${formatDate(incident.created)}
                            </div>
                        </div>
                    </div>
                `;
                messagesContainer.appendChild(cardDiv);
            });
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function viewIncidentDetailFromChat(incidentId) {
            closeChat();
            viewIncidentDetail(incidentId);
            showToast('Opening Incident', `Viewing details for ${incidentId}`);
        }

        // Mobile navigation
        document.addEventListener('DOMContentLoaded', () => {
            const mobileNavItems = document.querySelectorAll('.mobile-nav-item[data-page]');
            mobileNavItems.forEach(item => {
                item.addEventListener('click', () => {
                    // Update active state
                    mobileNavItems.forEach(navItem => navItem.classList.remove('active'));
                    item.classList.add('active');
                    
                    // Navigate
                    const page = item.dataset.page;
                    navigateToPage(page);
                });
            });
        });
    </script>
</body>
</html>