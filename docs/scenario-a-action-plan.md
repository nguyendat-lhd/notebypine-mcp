# Action Plan - Scenario A: Personal PoC (Single Machine)
## NoteByPine MCP Server Implementation

**Based on PRD Version 1.0**
**Target Deployment**: Personal Development Machine
**Implementation Timeline**: 2-4 weeks

---

## Overview

This action plan breaks down the implementation of Scenario A from the PRD - a personal PoC running on a single machine with local PocketBase database and MCP server accessible via Cursor IDE.

---

## Phase 0: Environment Setup (Day 1)

### 0.1 Install Required Tools
```bash
# Install Bun runtime
curl -fsSL https://bun.sh/install | bash

# Verify installation
bun --version

# Install development tools (optional but recommended)
code --install-extension ms-vscode.vscode-typescript-next
```

### 0.2 Download PocketBase
```bash
# Create project directory
mkdir notebypine-mcp
cd notebypine-mcp

# Download PocketBase binary for your OS
# macOS (arm64)
wget https://github.com/pocketbase/pocketbase/releases/download/v0.22.20/pocketbase_0.22.20_darwin_arm64.zip
unzip pocketbase_0.22.20_darwin_arm64.zip

# Make executable
chmod +x pocketbase
```

### 0.3 Initialize Project Structure
```bash
# Initialize Bun project
bun init -y

# Create directory structure
mkdir -p src/{mcp,db,services,types}
mkdir -p pb_data
mkdir -p scripts
mkdir -p tests

# Create required files
touch src/index.ts
touch src/config.ts
touch src/mcp/{tools,resources,prompts,handlers}.ts
touch src/db/{pocketbase,schema,queries}.ts
touch src/services/{incident,search}.ts
touch .env
touch bunfig.toml
```

---

## Phase 1: Core Infrastructure (Days 2-4)

### 1.1 Project Configuration
**File: `bunfig.toml`**
```toml
name = "notebypine-mcp"
module = "src/index.ts"
main = "src/index.ts"

[dev]
run = "bun --watch src/index.ts"

[test]
preload = ["./tests/setup.ts"]

[install]
exact = true
```

**File: `package.json` (auto-generated by bun, but add dependencies)**
```json
{
  "name": "notebypine-mcp",
  "scripts": {
    "dev": "bun --watch src/index.ts",
    "build": "bun build src/index.ts --outdir ./dist",
    "start": "bun src/index.ts",
    "pb:serve": "./pocketbase serve --dir ./pb_data",
    "setup:pocketbase": "bun scripts/setup-pocketbase.ts",
    "test": "bun test",
    "test:mcp": "bun test tests/mcp/"
  },
  "dependencies": {
    "@modelcontextprotocol/sdk": "^1.0.0",
    "pocketbase": "^0.21.5",
    "zod": "^3.22.4"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "bun-types": "latest"
  }
}
```

### 1.2 Environment Configuration
**File: `.env`**
```env
# PocketBase Configuration
POCKETBASE_URL=http://localhost:8090
POCKETBASE_ADMIN_EMAIL=admin@example.com
POCKETBASE_ADMIN_PASSWORD=admin123456

# MCP Server Configuration
MCP_PORT=3000
MCP_HOST=localhost

# Development
NODE_ENV=development
LOG_LEVEL=debug
```

### 1.3 TypeScript Configuration
**File: `tsconfig.json`**
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "skipLibCheck": true,
    "types": ["bun-types"],
    "outDir": "./dist",
    "rootDir": "./src"
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist", "pb_data"]
}
```

---

## Phase 2: PocketBase Setup & Schema (Days 5-6)

### 2.1 PocketBase Initialization Script
**File: `scripts/setup-pocketbase.ts`**
```typescript
#!/usr/bin/env bun
import PocketBase from 'pocketbase';

async function setupDatabase() {
  const pb = new PocketBase('http://localhost:8090');

  try {
    // Create admin user
    await pb.admins.create({
      email: process.env.POCKETBASE_ADMIN_EMAIL!,
      password: process.env.POCKETBASE_ADMIN_PASSWORD!,
    });

    console.log('‚úÖ Admin user created');

    // Login as admin
    await pb.admins.authViaEmail(
      process.env.POCKETBASE_ADMIN_EMAIL!,
      process.env.POCKETBASE_ADMIN_PASSWORD!
    );

    // Create collections based on PRD schema
    const collections = [
      {
        name: "incidents",
        type: "base",
        schema: [
          { name: "title", type: "text", required: true },
          { name: "category", type: "select", required: true, options: ["Backend", "Frontend", "DevOps", "Health", "Finance", "Mobile"] },
          { name: "description", type: "text", required: true },
          { name: "symptoms", type: "json" },
          { name: "context", type: "json" },
          { name: "environment", type: "json" },
          { name: "severity", type: "select", required: true, options: ["low", "medium", "high", "critical"] },
          { name: "status", type: "select", required: true, options: ["open", "investigating", "resolved", "archived"] },
          { name: "root_cause", type: "text" },
          { name: "frequency", type: "select", required: true, options: ["one-time", "occasional", "frequent", "recurring"] },
          { name: "visibility", type: "select", required: true, options: ["private", "team", "public"] }
        ]
      },
      // Add other collections (solutions, lessons_learned, tags, feedback)
    ];

    for (const collection of collections) {
      await pb.collections.create(collection);
      console.log(`‚úÖ Created collection: ${collection.name}`);
    }

    console.log('üéâ Database setup complete!');

  } catch (error) {
    console.error('‚ùå Setup failed:', error);
  }
}

setupDatabase();
```

### 2.2 PocketBase Client Module
**File: `src/db/pocketbase.ts`**
```typescript
import PocketBase from 'pocketbase';

let pb: PocketBase;

export function getPocketBase() {
  if (!pb) {
    pb = new PocketBase(process.env.POCKETBASE_URL || 'http://localhost:8090');

    // Auto-disable cancelation for easier development
    pb.autoCancellation(false);
  }

  return pb;
}

export async function initPocketBase() {
  const pb = getPocketBase();

  try {
    // Try to authenticate as admin
    await pb.admins.authViaEmail(
      process.env.POCKETBASE_ADMIN_EMAIL!,
      process.env.POCKETBASE_ADMIN_PASSWORD!
    );
    console.log('‚úÖ PocketBase authenticated');
  } catch (error) {
    console.warn('‚ö†Ô∏è PocketBase auth failed, make sure server is running');
  }
}
```

---

## Phase 3: MCP Server Core (Days 7-10)

### 3.1 Basic MCP Server Structure
**File: `src/index.ts`**
```typescript
#!/usr/bin/env bun
import { Server } from '@modelcontextprotocol/sdk/server/index.js';
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';
import {
  CallToolRequestSchema,
  ListToolsRequestSchema,
} from '@modelcontextprotocol/sdk/types.js';

import { registerTools } from './mcp/tools.js';
import { initPocketBase } from './db/pocketbase.js';

const server = new Server(
  {
    name: 'notebypine-mcp',
    version: '1.0.0',
  },
  {
    capabilities: {
      tools: {},
    },
  }
);

// Initialize PocketBase
await initPocketBase();

// Register all tools
registerTools(server);

// Start server
const transport = new StdioServerTransport();
await server.connect(transport);

console.error('NoteByPine MCP Server running on stdio');
```

### 3.2 Tool Definitions
**File: `src/mcp/tools.ts`**
```typescript
import { Server } from '@modelcontextprotocol/sdk/server/index.js';
import {
  CallToolRequestSchema,
  Tool,
} from '@modelcontextprotocol/sdk/types.js';

import { handleCreateIncident } from './handlers.js';
import { handleSearchIncidents } from './handlers.js';
import { handleAddSolution } from './handlers.js';
// ... import other handlers

const TOOLS: Tool[] = [
  {
    name: 'create_incident',
    description: 'Create a new incident record for troubleshooting',
    inputSchema: {
      type: 'object',
      properties: {
        title: { type: 'string', description: 'Brief title of the incident' },
        category: {
          type: 'string',
          enum: ['Backend', 'Frontend', 'DevOps', 'Health', 'Finance', 'Mobile'],
          description: 'Category of the incident'
        },
        description: { type: 'string', description: 'Detailed description of the problem' },
        symptoms: {
          type: 'array',
          items: { type: 'string' },
          description: 'List of symptoms observed'
        },
        context: { type: 'object', description: 'Context information (who, what, when, where, why, how)' },
        severity: {
          type: 'string',
          enum: ['low', 'medium', 'high', 'critical'],
          description: 'Severity level'
        }
      },
      required: ['title', 'category', 'description', 'severity']
    }
  },
  {
    name: 'search_incidents',
    description: 'Search existing incidents and solutions',
    inputSchema: {
      type: 'object',
      properties: {
        query: { type: 'string', description: 'Search query' },
        category: { type: 'string', description: 'Filter by category' },
        tags: {
          type: 'array',
          items: { type: 'string' },
          description: 'Filter by tags'
        },
        search_type: {
          type: 'string',
          enum: ['hybrid', 'keyword', 'semantic'],
          default: 'keyword',
          description: 'Type of search to perform'
        },
        limit: { type: 'number', default: 10, description: 'Maximum results to return' }
      },
      required: ['query']
    }
  },
  // ... add other tools (add_solution, extract_lessons, etc.)
];

export function registerTools(server: Server) {
  // List available tools
  server.setRequestHandler(ListToolsRequestSchema, async () => {
    return { tools: TOOLS };
  });

  // Handle tool calls
  server.setRequestHandler(CallToolRequestSchema, async (request) => {
    const { name, arguments: args } = request.params;

    try {
      switch (name) {
        case 'create_incident':
          return await handleCreateIncident(args);

        case 'search_incidents':
          return await handleSearchIncidents(args);

        case 'add_solution':
          return await handleAddSolution(args);

        // ... add other tool handlers

        default:
          throw new Error(`Unknown tool: ${name}`);
      }
    } catch (error) {
      return {
        content: [
          {
            type: 'text',
            text: `Error: ${error instanceof Error ? error.message : 'Unknown error'}`
          }
        ]
      };
    }
  });
}
```

---

## Phase 4: Tool Handlers Implementation (Days 11-14)

### 4.1 Incident Handlers
**File: `src/mcp/handlers.ts`**
```typescript
import { getPocketBase } from '../db/pocketbase.js';
import { z } from 'zod';

// Validation schemas
const CreateIncidentSchema = z.object({
  title: z.string().min(1),
  category: z.enum(['Backend', 'Frontend', 'DevOps', 'Health', 'Finance', 'Mobile']),
  description: z.string().min(1),
  symptoms: z.array(z.string()).optional(),
  context: z.record(z.any()).optional(),
  severity: z.enum(['low', 'medium', 'high', 'critical']),
});

export async function handleCreateIncident(args: any) {
  const validated = CreateIncidentSchema.parse(args);
  const pb = getPocketBase();

  try {
    const record = await pb.collection('incidents').create({
      ...validated,
      status: 'open',
      frequency: 'one-time',
      visibility: 'private',
      created_at: new Date().toISOString(),
    });

    return {
      content: [
        {
          type: 'text',
          text: `‚úÖ Incident created successfully!\\nID: ${record.id}\\nTitle: ${record.title}\\nStatus: ${record.status}`
        }
      ]
    };
  } catch (error) {
    throw new Error(`Failed to create incident: ${error}`);
  }
}

const SearchIncidentsSchema = z.object({
  query: z.string().min(1),
  category: z.string().optional(),
  tags: z.array(z.string()).optional(),
  search_type: z.enum(['hybrid', 'keyword', 'semantic']).default('keyword'),
  limit: z.number().default(10),
});

export async function handleSearchIncidents(args: any) {
  const validated = SearchIncidentsSchema.parse(args);
  const pb = getPocketBase();

  try {
    // Simple keyword search implementation
    const records = await pb.collection('incidents').getList(1, validated.limit, {
      filter: pb.filter('title ~ {:query} || description ~ {:query}', { query: validated.query }),
      sort: '-created_at'
    });

    if (records.items.length === 0) {
      return {
        content: [
          {
            type: 'text',
            text: 'No incidents found matching your search.'
          }
        ]
      };
    }

    const results = records.items.map(incident => ({
      id: incident.id,
      title: incident.title,
      category: incident.category,
      description: incident.description.substring(0, 200) + '...',
      severity: incident.severity,
      status: incident.status,
      created_at: incident.created_at
    }));

    return {
      content: [
        {
          type: 'text',
          text: `Found ${records.items.length} incidents:\\n\\n${results.map(r =>
            `üîç ${r.title}\\n   Category: ${r.category}\\n   Severity: ${r.severity}\\n   Status: ${r.status}\\n   Created: ${new Date(r.created_at).toLocaleDateString()}\\n   ${r.description}\\n`
          ).join('\\n')}`
        }
      ]
    };
  } catch (error) {
    throw new Error(`Search failed: ${error}`);
  }
}

// ... implement other handlers (add_solution, extract_lessons, etc.)
```

---

## Phase 5: Testing & Integration (Days 15-18)

### 5.1 Unit Tests
**File: `tests/mcp/tools.test.ts`**
```typescript
import { describe, it, expect, beforeAll } from 'bun:test';
import { handleCreateIncident, handleSearchIncidents } from '../../src/mcp/handlers.js';
import { initPocketBase } from '../../src/db/pocketbase.js';

describe('MCP Tools', () => {
  beforeAll(async () => {
    await initPocketBase();
  });

  it('should create an incident', async () => {
    const result = await handleCreateIncident({
      title: 'Test Incident',
      category: 'Backend',
      description: 'This is a test incident',
      severity: 'medium'
    });

    expect(result.content[0].text).toContain('‚úÖ Incident created successfully');
  });

  it('should search incidents', async () => {
    const result = await handleSearchIncidents({
      query: 'Test',
      limit: 5
    });

    expect(result.content[0].text).toBeDefined();
  });
});
```

### 5.2 Manual Testing Script
**File: `scripts/test-manual.ts`**
```typescript
#!/usr/bin/env bun
import { getPocketBase } from '../src/db/pocketbase.js';

async function testManual() {
  const pb = getPocketBase();

  console.log('üß™ Testing PocketBase connection...');
  try {
    const health = await pb.health.check();
    console.log('‚úÖ PocketBase is healthy');
  } catch (error) {
    console.error('‚ùå PocketBase health check failed:', error);
    return;
  }

  console.log('üß™ Creating test incident...');
  const incident = await pb.collection('incidents').create({
    title: 'Test PostgreSQL Connection Issue',
    category: 'Backend',
    description: 'Cannot connect to PostgreSQL database from application',
    severity: 'high',
    status: 'open',
    symptoms: ['connection timeout', 'database error'],
    context: {
      environment: 'development',
      application: 'web-app'
    }
  });

  console.log('‚úÖ Test incident created:', incident.id);

  console.log('üß™ Searching for incidents...');
  const results = await pb.collection('incidents').getList(1, 10, {
    filter: 'title ~ "PostgreSQL"',
    sort: '-created_at'
  });

  console.log(`‚úÖ Found ${results.items.length} incidents`);
  results.items.forEach(item => {
    console.log(`  - ${item.title} (${item.severity})`);
  });
}

testManual();
```

---

## Phase 6: Cursor IDE Integration (Days 19-21)

### 6.1 Cursor Configuration
Create configuration file for Cursor:
**File: `cursor-config.json`**
```json
{
  "mcpServers": {
    "notebypine": {
      "command": "bun",
      "args": ["run", "/path/to/your/notebypine-mcp/src/index.ts"],
      "env": {
        "POCKETBASE_URL": "http://localhost:8090",
        "MCP_PORT": "3000",
        "POCKETBASE_ADMIN_EMAIL": "admin@example.com",
        "POCKETBASE_ADMIN_PASSWORD": "admin123456"
      }
    }
  }
}
```

### 6.2 Startup Scripts
**File: `scripts/start-dev.sh`**
```bash
#!/bin/bash

echo "üöÄ Starting NoteByPine Development Environment..."

# Start PocketBase in background
echo "Starting PocketBase..."
./pocketbase serve --dir ./pb_data &
PB_PID=$!

# Wait for PocketBase to be ready
echo "Waiting for PocketBase to start..."
sleep 3

# Initialize database if needed
echo "Setting up database..."
bun run setup:pocketbase

# Start MCP Server
echo "Starting MCP Server..."
bun run dev &
MCP_PID=$!

echo "‚úÖ All services started!"
echo "PocketBase: http://localhost:8090"
echo "MCP Server: Running on stdio"
echo ""
echo "To stop all services:"
echo "kill $PB_PID $MCP_PID"

# Wait for user input to stop
read -p "Press Enter to stop all services..."

kill $PB_PID $MCP_PID
echo "üõë All services stopped"
```

---

## Phase 7: Performance Optimization & Polish (Days 22-28)

### 7.1 Performance Monitoring
**File: `src/utils/performance.ts`**
```typescript
export function measureTime<T>(fn: () => Promise<T>, label: string): Promise<T> {
  return new Promise(async (resolve, reject) => {
    const start = performance.now();
    try {
      const result = await fn();
      const duration = performance.now() - start;
      console.log(`‚è±Ô∏è ${label}: ${duration.toFixed(2)}ms`);

      // Warn if exceeding PRD targets
      if (duration > 300) {
        console.warn(`‚ö†Ô∏è ${label} exceeded 300ms target (${duration.toFixed(2)}ms)`);
      }

      resolve(result);
    } catch (error) {
      const duration = performance.now() - start;
      console.error(`‚ùå ${label} failed after ${duration.toFixed(2)}ms:`, error);
      reject(error);
    }
  });
}
```

### 7.2 Error Handling & Logging
**File: `src/utils/logger.ts`**
```typescript
export enum LogLevel {
  DEBUG = 0,
  INFO = 1,
  WARN = 2,
  ERROR = 3,
}

const LOG_LEVEL = process.env.LOG_LEVEL === 'debug' ? LogLevel.DEBUG : LogLevel.INFO;

export class Logger {
  static debug(message: string, ...args: any[]) {
    if (LOG_LEVEL <= LogLevel.DEBUG) {
      console.error(`[DEBUG] ${message}`, ...args);
    }
  }

  static info(message: string, ...args: any[]) {
    if (LOG_LEVEL <= LogLevel.INFO) {
      console.error(`[INFO] ${message}`, ...args);
    }
  }

  static warn(message: string, ...args: any[]) {
    if (LOG_LEVEL <= LogLevel.WARN) {
      console.error(`[WARN] ${message}`, ...args);
    }
  }

  static error(message: string, ...args: any[]) {
    if (LOG_LEVEL <= LogLevel.ERROR) {
      console.error(`[ERROR] ${message}`, ...args);
    }
  }
}
```

---

## Success Criteria Checklist

Based on PRD success criteria, verify each item:

- [ ] MCP server starts within 500ms via Bun
- [ ] Cursor connects and lists available tools instantly
- [ ] Create incident tool works end-to-end (< 100ms)
- [ ] Search returns relevant results within 300ms
- [ ] Can add solution & extract lessons (< 100ms each)
- [ ] 10+ test incidents stored successfully
- [ ] No data loss on restart
- [ ] Cursor can autocomplete based on stored knowledge
- [ ] Memory footprint stays under 50MB during operation
- [ ] Bun bundle size under 10MB

---

## Troubleshooting Guide

### Common Issues

1. **PocketBase connection failed**
   ```bash
   # Check if PocketBase is running
   curl http://localhost:8090/api/health

   # Check logs
   ./pocketbase serve --dir ./pb_data --debug
   ```

2. **MCP Server not responding in Cursor**
   - Check environment variables are set correctly
   - Verify Cursor configuration path
   - Check MCP server logs in terminal

3. **Performance issues**
   ```bash
   # Monitor memory usage
   ps aux | grep pocketbase
   ps aux | grep bun

   # Test response times
   bun run test:performance
   ```

4. **Database schema issues**
   ```bash
   # Reset database
   rm -rf pb_data/*
   bun run setup:pocketbase
   ```

---

## Next Steps After PoC

1. **Add semantic search** with embeddings
2. **Implement more sophisticated AI integrations**
3. **Add real-time sync capabilities**
4. **Create mobile app interface**
5. **Set up cloud synchronization**
6. **Add team collaboration features**

---

**End of Action Plan**

üåü *Knowledge grows like pines ‚Äì deep roots, steady growth, timeless wisdom*